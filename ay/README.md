Code part obtained from
https://bitbucket.org/CmGonzalez/gandalf